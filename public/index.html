<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Teste i-Cherry</title>
    <link rel="icon" href="assets/icon-icherry.webp" />

    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1 class="header-titulo">
        Teste
        <img
          src="assets/logo-icherry.webp"
          alt="iCherry Logo"
          class="logo-header"
        />
      </h1>
    </header>

    <nav>
      <button class="tab-button active" data-tab="botoes">Botões</button>
      <button class="tab-button" data-tab="questoes">Questões</button>
    </nav>

    <div class="download-container">
      <a href="assets/teste-icherry.pdf" download class="btn-download">
        Baixar teste
      </a>
    </div>

    <section id="botoes" class="active">
      <h2>Botões</h2>

      <div class="botao-linha">
        <div class="coluna">
          <button id="comprar" class="btn">Comprar Agora</button>
          <span id="resultComprarAgora" class="resultado"></span>
        </div>
        <div class="coluna">
          <button id="extrairId" class="btn">Extrair ID da URL</button>
          <span id="resultExtrairId" class="resultado"></span>
        </div>
      </div>

      <div class="botao-linha">
        <div class="coluna">
          <button id="contadorBtn" class="btn">Testar Contador</button>
          <span id="resultadoContador" class="resultado"></span>
        </div>
        <div class="coluna">
          <button id="fetchBtn" class="btn">Buscar Dados</button>
          <input
            title="URL para fetch"
            type="text"
            value="https://jsonplaceholder.typicode.com/posts"
            id="inputFetch"
            class="input-fetch"
          />
        </div>
      </div>

      <div class="botao-linha">
        <div class="coluna">
          <button id="mapProdutos" class="btn">Formatar Produtos</button>
          <div id="resultadoProdutos" class="resultado"></div>
        </div>
        <div class="coluna">
          <label for="inputArray">Digite separado por ";"</label>
          <input
            title="Array para converter"
            type="text"
            id="inputArray"
            class="input-fetch"
            value="camiseta;calça;tênis"
          />
          <button id="btnArray" class="btn">Converter</button>
          <div id="resultadoArray" class="resultado-array"></div>
        </div>
      </div>
    </section>

    <section id="questoes">
      <h2>Questões e Respostas</h2>
      <p>
        <strong>6. GTM - Conceitos:</strong> <br /> Variável: Espaços para armazenar
        valores. Por exemplo: URL da página, ID ou preço de um produto <br />
        Trigger: Condições/gatilhos que disparam as tags de acordo com determinadas
        ações. Por exemplo disparar a tag x se um botão for clicado; <br />
        Tag: O script da ferramenta de análise. O pedaço do código que é executado quando as condições do trigger são atendidas.
      </p>
      <p>
        <strong>7. Data Layer:</strong> <br/>
        1. É um objeto JS que funciona como uma "caixa" onde você armazena informações importantes do 
        seu site ou aplicação para serem enviadas. É o intermediário entre o site e o GTM. <br />
        A principal importância é que ele mantém os dados centralizados e estruturados. Facilita o envio de informações para o GTM. <br />
        2. Exemplo de Data Layer:
        <pre>
            dataLayer.push({
            event: "compra_realizada",
            valor: 150.00,
            produto: "Tênis"
          });
        </pre>
        O "event" sendo o gatilho que dispara a tag de acompanhamento de compra. E os outros dados também podem ser usados. <br />
        <br />
      </p>
      <p>
        <strong>8. Organização e Prioridades:</strong> <br />
        1 - Definir métricas, oque exatamente será medido ( cliques e interações
        ). <br />
        Criar um documento de especificação, incluindo o nome exato dos
        eventos/parâmetros, onde eles disparam e quais dados precisam ser
        capturados (Ex: ID do banner, posição, nome da promoção).
        Mapear quais informações o desenvolvedor precisa disponibilizar no Data Layer.
        Configuração de tags, triggers e variáveis no GTM.
        <br /><br />

        2 - Reunião inicial: Organizar uma reunião com marketing, analistas e
        desenvolvedores.<br />
        O Documento de especificação de rastreamento deve ser compartilhado e aprovado por todos. Qualquer alteração deve ser registrada lá.
        Definição de funções e responsabilidades:<br />
        Marketing: Define a necessidade e o uso dos dados.<br />
        Desenvolvedores: São responsáveis por implementar a camada de dados.<br />
        Analistas: São responsáveis por configurar o Gerenciador de Tags e
        validar os dados.
      </p>
    </section>

    <!-- Modal -->
    <div id="modalFetch">
      <div id="modalContent">
        <span id="closeModal">&times;</span>
        <pre id="modalData"></pre>
      </div>
    </div>

    <script>
      // Controle de abas
      const buttons = document.querySelectorAll(".tab-button");
      const sections = document.querySelectorAll("section");

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          buttons.forEach((b) => b.classList.remove("active"));
          sections.forEach((s) => s.classList.remove("active"));

          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");
        });
      });

      // 1. Botão comprar
      document.getElementById("comprar").addEventListener("click", () => {
        document.getElementById("resultComprarAgora").textContent =
          "Botão comprar clicado";
        console.log("Botão comprar clicado");
      });

      // 2. Extrair ID da URL
      document.getElementById("extrairId").addEventListener("click", () => {
        const url = "https://www.exemplo.com/produto?id=123&ref=afiliado";
        const params = new URL(url).searchParams;
        const id = params.get("id");
        document.getElementById("resultExtrairId").textContent = `ID: ${id}`;
        console.log("ID extraído:", id);
      });

      // 3. Contador
      function criarContador() {
        let count = 0;
        return function () {
          count++;
          document.getElementById("resultadoContador").textContent = count;
          console.log(count);
        };
      }
      const contador = criarContador();
      document
        .getElementById("contadorBtn")
        .addEventListener("click", contador);

      // 4. Buscar dados via fetch e mostrar no modal
      const modal = document.getElementById("modalFetch");
      const modalContent = document.getElementById("modalData");
      const closeModal = document.getElementById("closeModal");

      document.getElementById("fetchBtn").addEventListener("click", () => {
        const url = document.getElementById("inputFetch").value.trim();
        if (!url) {
          modalContent.textContent = "Erro: Digite uma URL!";
          modal.style.display = "block";
          return;
        }

        fetch(url)
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Falha na requisição. Status ${res.status}`);
            }
            return res
              .json()
              .then((data) => JSON.stringify(data, null, 2))
              .catch(() =>
                res.text().then((text) => `O conteúdo não é JSON:\n${text}`)
              );
          })
          .then((finalData) => {
            modalContent.textContent = finalData;
            modal.style.display = "block";
          })
          .catch((err) => {
            modalContent.textContent = "URL inválida:\n" + err;
            modal.style.display = "block";
          });
      });

      // Fechar modal
      closeModal.addEventListener(
        "click",
        () => (modal.style.display = "none")
      );
      window.addEventListener("click", (e) => {
        if (e.target == modal) modal.style.display = "none";
      });

      // 5. Map produtos
      document.getElementById("mapProdutos").addEventListener("click", () => {
        const produtos = [
          { id: 1, nome: "Camiseta", preco: 50 },
          { id: 2, nome: "Calça", preco: 120 },
          { id: 3, nome: "Tênis", preco: 250 },
        ];
        const nomes = produtos.map((p) => p.nome.toUpperCase());
        console.log("Produtos formatados:", nomes);
        document.getElementById("resultadoProdutos").textContent =
          "Produtos formatados: " + nomes.join(", ");
      });

      // 6. Input array
      document.getElementById("btnArray").addEventListener("click", () => {
        const input = document.getElementById("inputArray").value;
        if (!input) {
          return alert("Digite algo!");
        }
        const array = input.split(";").map((s) => s.trim().toUpperCase());
        document.getElementById("resultadoArray").textContent = `[${array.join(
          ", "
        )}]`;
        console.log(array);
      });
    </script>
  </body>
</html>
